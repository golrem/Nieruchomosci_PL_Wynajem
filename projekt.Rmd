---
title: "Projekt"
output: github_document
---
#Jak nie macie pakietów wklepcie w konsole (po kolei)
install.packages('tidyverse')
install.packages('naniar')
install.packages('visdat')
install.packages('editrules')
install.packages('VIM')
install.packages('validate')
install.packages('validatetools')
install.packages('dplyr')
install.packages('errorlocate')
install.packages('dlookr')
#### Przygotowanie bibliotek i wczytanie pliku
```{r}
library(tidyverse)
library(dplyr)
library(naniar)
library(visdat)
library(editrules)
library(VIM)
library(validate)
library(validatetools)
library(errorlocate)
library(mice)
library(dlookr)
```
#### Wczytanie danych i wyświetlenie
```{r}
data <- read_csv("apartments_rent_pl_2024_06.csv")
spec(data)
```

#### Walidacja Danych
```{r}
vis_dat(data, palette = "cb_safe")
```

#### NA w danych
```{r}
gg_miss_var(data)
```

#### Czyszczenie danych
```{r}
nrow(data[complete.cases(data), ])/nrow(data)*100
```


```{r}
rules <- validator(
  squareMeters > 0, 
  rooms > 0,
  latitude > 0,
  buildYear > 0,
  price > 0,
  hasParkingSpace %in% c('yes', 'no'),
  hasBalcony %in% c('yes', 'no'),
  hasElevator %in% c('yes', 'no'),
  hasSecurity %in% c('yes', 'no'),
  hasStorageRoom %in% c('yes', 'no')
)

simplified_rules <- simplify_rules(rules)


```
```{r}
VIM::aggr(data)
```
#### Imputacja NA dla kolumn z brakami
```{r}
floors<-imputate_na(data, floor, method = "mice")
summary(floors)
plot(floors)
```

```{r}
floorCount<-imputate_na(data, floorCount, method = "mice")
summary(floorCount)
plot(floorCount)
```


```{r}
buildYear<-imputate_na(data, buildYear, method = "mice")
summary(buildYear)
plot(buildYear)
```

```{r}
buildYear<-imputate_na(data, buildYear, method = "mice")
summary(buildYear)
plot(buildYear)
```

```{r}
data$floor <- floors
data$floorCount <- floorCount
data$buildYear <- buildYear

data$floor <- round(data$floor)
data$floorCount <- round(data$floorCount)
data$buildYear <- round(data$buildYear)
mean <- mean(data$collegeDistance, na.rm = TRUE)
data$collegeDistance <- ifelse(is.na(data$collegeDistance), mean, data$collegeDistance)
mean <- mean(data$restaurantDistance, na.rm = TRUE)
data$restaurantDistance <- ifelse(is.na(data$restaurantDistance), mean, data$restaurantDistance)
mean <- mean(data$pharmacyDistance, na.rm = TRUE)
data$pharmacyDistance <- ifelse(is.na(data$pharmacyDistance), mean, data$pharmacyDistance)
mean <- mean(data$clinicDistance, na.rm = TRUE)
data$clinicDistance <- ifelse(is.na(data$clinicDistance), mean, data$clinicDistance)
mean <- mean(data$postOfficeDistance, na.rm = TRUE)
data$postOfficeDistance <- ifelse(is.na(data$postOfficeDistance), mean, data$postOfficeDistance)
mean <- mean(data$kindergartenDistance, na.rm = TRUE)
data$kindergartenDistance <- ifelse(is.na(data$kindergartenDistance), mean, data$kindergartenDistance)
```

```{r}
rules <- validator(
  if (floorCount >= 4) hasElevator == 'yes'
)

results <- confront(data, rules)

summary(results)

```

```{r}
data$hasElevator <- ifelse(is.na(data$hasElevator) & data$floorCount > 4, 'yes', ifelse(is.na(data$hasElevator) & data$floorCount <= 4, 'no', data$hasElevator))
```

```{r}

replace_na_random <- function(column) {
  na_indices <- which(is.na(column))
  non_na_values <- column[!is.na(column)]
  column[na_indices] <- sample(non_na_values, length(na_indices), replace = TRUE)
  return(column)
}


data$type <- replace_na_random(data$type)
data$condition <- replace_na_random(data$condition)
data$buildingMaterial <- replace_na_random(data$buildingMaterial)


```

```{r}
gg_miss_var(data)
```


