### **Data Wrangling**

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(naniar)
library(visdat)
library(editrules)
library(VIM)
library(validate)
library(validatetools)
library(errorlocate)
library(mice)
library(dlookr)
library(psych)
library(knitr)
library(kableExtra)
library(corrplot)
library(psych)
library(gtsummary)
library(summarytools)
library(dplyr)
library(ggplot2)
library(gsubfn)
library(stats)
library(nortest)
```

1.  Wczytanie danych i wy≈õwietlenie

```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- read_csv("apartments_rent_pl_2024_06.csv")
spec(data)
```

*Zbi√≥r danych zawiera **8849** obserwacji dotyczƒÖcych wynajmu mieszka≈Ñ w polskich miastach, do czynienia mamy ze zmiennymi:*

-   **price**: Cena wynajmu mieszkania,
-   **city**: Miasto, gdzie znajduje siƒô mieszkanie,
-   **rooms**: Ilo≈õƒá pokoi,
-   **squareMeters**: Powierzchnia w metrach kwadratowych,
-   **floorCount**: Liczba piƒôter budynku,
-   **floor**: Piƒôtro mieszkania,
-   **buildYear**: Rok budowy budynku.

*R√≥wnie≈º wystƒôpujƒÖ zmienne dotyczƒÖce odleg≈Ço≈õci obiekt√≥w od mieszkania, takie jak:*

-   **schoolDistance**: Odleg≈Ço≈õƒá od szko≈Çy,
-   **kindergartenDistance**: Odleg≈Ço≈õƒá od przedszkole,
-   **restaurantDistance**: Odleg≈Ço≈õƒá od restauracji,
-   **collegeDistance**: Odleg≈Ço≈õƒá od uczelni,
-   **pharmacyDistance**: Odleg≈Ço≈õƒá od apteki.

*ZnajdujƒÖ siƒô jeszcze zmienne opisujƒÖce wyposa≈ºenie poprzez warto≈õƒá **yes** lub **no**:*

-   **hasParkingSpace**: Czy obiekt ma parking,
-   **hasBalcony**: Czy obiekt ma balkon,
-   **hasElevator**: Czy obiekt ma windƒô,
-   **hasSecurity**: Czy obiekt ma ochronƒô,
-   **hasStorageRoom**: Czy obiekt ma kom√≥rkƒô lokatorskƒÖ.

2.  Walidacja Danych

```{r echo=FALSE, message=FALSE, warning=FALSE}
vis_dat(data, palette = "cb_safe")
```

*Z wykresu ukazanego powy≈ºej, widzimy braki warto≈õci zmiennych poszczeg√≥lnych obserwacji*

3.  NA w danych

```{r echo=FALSE, message=FALSE, warning=FALSE}
gg_miss_var(data)
```

*NajwiƒôkszƒÖ ilo≈õƒá brakujƒÖcych warto≈õci widzimy w zmiennych:*

-   **condition**
-   **buildingMaterial**
-   **buildYear**

4.  Czyszczenie danych

```{r echo=FALSE, message=FALSE, warning=FALSE}
nrow(data[complete.cases(data), ])/nrow(data)*100
```

*15% naszych danych zawiera braki*

```{r echo=FALSE, message=FALSE, warning=FALSE}
rules <- validator(
  squareMeters > 0, 
  rooms > 0,
  latitude > 0,
  buildYear > 0,
  price > 0,
  hasParkingSpace %in% c('yes', 'no'),
  hasBalcony %in% c('yes', 'no'),
  hasElevator %in% c('yes', 'no'),
  hasSecurity %in% c('yes', 'no'),
  hasStorageRoom %in% c('yes', 'no')
)

simplified_rules <- simplify_rules(rules)


```

*Niestety nasze regu≈Çy nie przynios≈Çy oczekiwanych efekt√≥w üôÅ*

```{r echo=FALSE, message=FALSE, warning=FALSE}
VIM::aggr(data)
```

*Wygenerowali≈õmy heatmapƒô zmiennych, aby lepiej ukazaƒá nasze braki* *Nastƒôpnie wykorzystujƒÖƒá inputacjƒô uzupe≈Çnili≈õmy braki*

5.  Imputacja NA dla kolumn z brakami

```{r echo=FALSE, message=FALSE, warning=FALSE}
floors<-imputate_na(data, floor, method = "mice")
summary(floors)
plot(floors)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
floorCount<-imputate_na(data, floorCount, method = "mice")
summary(floorCount)
plot(floorCount)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
buildYear<-imputate_na(data, buildYear, method = "mice")
summary(buildYear)
plot(buildYear)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
buildYear<-imputate_na(data, buildYear, method = "mice")
summary(buildYear)
plot(buildYear)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
data$floor <- floors
data$floorCount <- floorCount
data$buildYear <- buildYear

data$floor <- round(data$floor)
data$floorCount <- round(data$floorCount)
data$buildYear <- round(data$buildYear)
mean <- mean(data$collegeDistance, na.rm = TRUE)
data$collegeDistance <- ifelse(is.na(data$collegeDistance), mean, data$collegeDistance)
mean <- mean(data$restaurantDistance, na.rm = TRUE)
data$restaurantDistance <- ifelse(is.na(data$restaurantDistance), mean, data$restaurantDistance)
mean <- mean(data$pharmacyDistance, na.rm = TRUE)
data$pharmacyDistance <- ifelse(is.na(data$pharmacyDistance), mean, data$pharmacyDistance)
mean <- mean(data$clinicDistance, na.rm = TRUE)
data$clinicDistance <- ifelse(is.na(data$clinicDistance), mean, data$clinicDistance)
mean <- mean(data$postOfficeDistance, na.rm = TRUE)
data$postOfficeDistance <- ifelse(is.na(data$postOfficeDistance), mean, data$postOfficeDistance)
mean <- mean(data$kindergartenDistance, na.rm = TRUE)
data$kindergartenDistance <- ifelse(is.na(data$kindergartenDistance), mean, data$kindergartenDistance)
```

*Dla zmiennych opisujƒÖcych odleg≈Ço≈õƒá od obiekt√≥w zastosowali≈õmy medianƒô*

```{r echo=FALSE, message=FALSE, warning=FALSE}
rules <- validator(
  if (floorCount >= 4) hasElevator == 'yes'
)

results <- confront(data, rules)

summary(results)

```

*Wprowadzili≈õmy warunek w kt√≥rym, je≈ºeli w budynku jest powy≈ºej 4 kondygnacji, to budynek musi mieƒá windƒô*

```{r echo=FALSE, message=FALSE, warning=FALSE}
data$hasElevator <- ifelse(is.na(data$hasElevator) & data$floorCount > 4, 'yes', ifelse(is.na(data$hasElevator) & data$floorCount <= 4, 'no', data$hasElevator))
```

*Przy pomocy warto≈õci zmiennych w poszczeg√≥lnych kolumnach, uzupe≈Çnili≈õmy w spos√≥b losowy braki danych w nich wystƒôpujƒÖce*

```{r include=FALSE}

replace_na_random <- function(column) {
  na_indices <- which(is.na(column))
  non_na_values <- column[!is.na(column)]
  column[na_indices] <- sample(non_na_values, length(na_indices), replace = TRUE)
  return(column)
}


data$type <- replace_na_random(data$type)
data$condition <- replace_na_random(data$condition)
data$buildingMaterial <- replace_na_random(data$buildingMaterial)


```

```{r echo=FALSE, message=FALSE, warning=FALSE}
gg_miss_var(data)
```

*Zbi√≥r zosta≈Ç uzupe≈Çniony z wszelakich brak√≥w, co ukazuje powy≈ºszy wykres*

### **Wizualizacja danych**

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)
library(pheatmap)
library(tidyr)

```

1.  Powierzchnia

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data, aes(x = squareMeters)) +
  geom_histogram(fill = "skyblue4", bins = 100) +
  labs(title = 'Powierzchnia') +
  scale_x_continuous(breaks = seq(0, max(data$squareMeters), by = 10))+ theme_minimal()
```

*Powy≈ºszy wykres przedstawia rozk≈Çad powierzchni mieszka≈Ñ, gdzie najwiƒôcej mieszka≈Ñ posiada powierzchniƒô miƒôdzy 50 - 60 m¬≤*

2.  Liczba Pokoi

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data, aes(x = rooms)) +
  geom_bar(fill = "skyblue4") +
  labs(title = 'Liczba pokoi') +
  theme_minimal()
```

*Na wykresie mo≈ºemy zauwa≈ºyƒá, ≈ºe najwiƒôcej mieszka≈Ñ jest dwupokojowych*

3.  Cena za wynajem vs Powierzchnia

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data, aes(x = squareMeters, y = price)) + 
  geom_point(alpha = 0.3, color = "skyblue4") + 
  labs(title = "Cena za wynajem vs Powierzchnia", 
       x = "Powierzchnia (m¬≤)", 
       y = "Cena za wynajem") + 
  theme_minimal()
```

*Im wiƒôksza powierzchnia mieszkania, tym wy≈ºsza cena wynajmu.* *Wiƒôksze powierzchnie majƒÖ szerszy zakres cen wynajmu, co oznacza wiƒôkszƒÖ r√≥≈ºnorodno≈õƒá w cenach dla wiƒôkszych mieszka≈Ñ.*

4.  Gƒôsto≈õƒá rozk≈Çadu ceny

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data, aes(x = price, fill = condition)) +
  geom_density(alpha = 0.25) +
  labs(title = "Gƒôsto≈õƒá rozk≈Çadu cen w zale≈ºno≈õci od stanu mieszkania",
       x = "Cena",
       y = "Gƒôsto≈õƒá",
       fill = "Stan mieszkania") +
  theme_minimal()

```

-   **Mieszkania premium sƒÖ dro≈ºsze:** Ceny mieszka≈Ñ premium sƒÖ wyra≈∫nie wy≈ºsze ni≈º mieszka≈Ñ o ni≈ºszym standardzie.

-   **Wiƒôksze zr√≥≈ºnicowanie cen premium:** Mieszkania premium majƒÖ bardziej rozproszony rozk≈Çad cen, co oznacza wiƒôkszƒÖ r√≥≈ºnorodno≈õƒá w tej kategorii.

-   **Niski standard = ni≈ºsze ceny:** Wiƒôkszo≈õƒá mieszka≈Ñ o ni≈ºszym standardzie skupia siƒô w ni≈ºszym przedziale cenowym.

-   **Wyra≈∫ny podzia≈Ç cen:** R√≥≈ºnica miƒôdzy kategoriami (low i premium) sugeruje wyra≈∫ne segmenty rynku mieszka≈Ñ.

5.  Cena vs Odleg≈Ço≈õƒá

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data, aes(x = centreDistance, y = price)) + geom_point(color = "skyblue4", alpha = 0.6) + labs(title = "Cena vs Odleg≈Ço≈õƒá od centrum", x = "Odleg≈Ço≈õƒá od centrum (km)", y = "Cena") + theme_minimal()

```

-   **Cena spada wraz z odleg≈Ço≈õciƒÖ od centrum:** Og√≥lnie widoczna jest tendencja, ≈ºe ceny mieszka≈Ñ malejƒÖ, im wiƒôksza jest odleg≈Ço≈õƒá od centrum miasta (odleg≈Ço≈õƒá \> 5 km).

-   **Zr√≥≈ºnicowanie cen bli≈ºej centrum:** W bliskiej odleg≈Ço≈õci od centrum (0‚Äì5 km) ceny sƒÖ bardzo zr√≥≈ºnicowane, z wieloma drogimi mieszkaniami (\>10 000).

-   **Stabilizacja cen w wiƒôkszej odleg≈Ço≈õci:** W odleg≈Ço≈õci powy≈ºej 10 km ceny sƒÖ bardziej skupione w ni≈ºszych przedzia≈Çach (\<5000), a bardzo drogie mieszkania sƒÖ rzadko≈õciƒÖ.

-   **Blisko≈õƒá centrum ma znaczenie:** Lokalizacja bli≈ºej centrum miasta wyra≈∫nie wp≈Çywa na wy≈ºszƒÖ cenƒô mieszka≈Ñ.

6.  Liczba mieszka≈Ñ na wynajem i ≈õrednia cena najmu w miastach Polski

```{r echo=FALSE, message=FALSE, warning=FALSE}
city_data <- data %>%
  group_by(city) %>%
  summarize(
    num_properties = n(),
    avg_price = mean(price),
    latitude = mean(latitude),
    longitude = mean(longitude)
  )

poland <- ne_countries(scale = "medium", country = "Poland", returnclass = "sf")


ggplot() +
  geom_sf(data = poland) +
  geom_point(data = city_data, aes(x = longitude, y = latitude, size = num_properties, color = avg_price), alpha = 0.7) +
  scale_color_gradient(low = "skyblue", high = "skyblue4", name = "≈örednia cena") +
  scale_size_continuous(name = "Liczba nieruchomo≈õci") +
  geom_text(data = city_data, aes(x = longitude, y = latitude, label = city), 
            size = 3, color = "black", vjust = -1, hjust = 0.7) +
  labs(title = "Liczba mieszka≈Ñ na wynajem i ≈õrednia cena najmu w miastach Polski") +
  theme_void()
```

-   **Warszawa dominuje**: ma najwiƒôkszƒÖ liczbƒô mieszka≈Ñ na wynajem oraz najwy≈ºsze ≈õrednie ceny.

-   **Wiƒôksze miasta = wy≈ºsze ceny** ‚Äì w miastach takich jak Krak√≥w, Wroc≈Çaw i Gda≈Ñsk ceny sƒÖ stosunkowo wysokie.

-   **Mniejsze miasta majƒÖ ni≈ºsze ceny** ‚Äì np. w Radomiu czy Czƒôstochowie ceny wynajmu sƒÖ znacznie ni≈ºsze.

-   **R√≥≈ºnice regionalne** ‚Äì ceny i liczba ofert sƒÖ wyra≈∫nie zr√≥≈ºnicowane w zale≈ºno≈õci od miasta.

7.  Heatmapa korelacji zmiennych

```{r echo=FALSE, message=FALSE, warning=FALSE}
selected_columns <- c("centreDistance", "schoolDistance", "clinicDistance", 
                      "postOfficeDistance", "kindergartenDistance", 
                      "restaurantDistance", "collegeDistance", "pharmacyDistance", "price")

correlation_matrix <- cor(data[selected_columns])

pheatmap(correlation_matrix, 
         color = colorRampPalette(c("skyblue2", "white", "skyblue4"))(100),
         display_numbers = TRUE,
         clustering_method = "complete",
         main = "Heatmapa korelacji zmiennych")

```

-   **Cena (price) ma negatywnƒÖ korelacjƒô z odleg≈Ço≈õciƒÖ od centrum (-0.15)** ‚Äì im dalej od centrum, tym ni≈ºsza cena.

-   **Podobna zale≈ºno≈õƒá dotyczy odleg≈Ço≈õci od przedszkola, szko≈Çy i poczty** ‚Äì im dalej, tym ni≈ºsza cena, ale korelacje sƒÖ s≈Çabe.

-   **Najsilniejsze dodatnie korelacje wystƒôpujƒÖ miƒôdzy r√≥≈ºnymi odleg≈Ço≈õciami** ‚Äì np. odleg≈Ço≈õƒá od restauracji i apteki (0.43) lub centrum i uczelni (0.57).

-   **Brak silnych zale≈ºno≈õci miƒôdzy cenƒÖ a wiƒôkszo≈õciƒÖ zmiennych** ‚Äì oznacza to, ≈ºe inne czynniki mogƒÖ mieƒá wiƒôkszy wp≈Çyw na cenƒô mieszka≈Ñ.

8.  Gƒôsto≈õƒá rozk≈Çadu cen mieszka≈Ñ

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data, aes(x = price)) +
  geom_density(fill = "skyblue4", alpha = 0.6) +
  labs(
    title = "Gƒôsto≈õƒá rozk≈Çadu cen mieszka≈Ñ",
    x = "Cena",
    y = "Gƒôsto≈õƒá"
  ) +
  theme_minimal()


```

-   **Asymetria prawostronna** ‚Äì wiƒôkszo≈õƒá mieszka≈Ñ ma ceny poni≈ºej 5000, ale istniejƒÖ nieliczne drogie oferty, co powoduje d≈Çugi prawy ogon.

-   **Najwiƒôcej mieszka≈Ñ w przedziale 2000-4000** ‚Äì szczyt rozk≈Çadu wskazuje, ≈ºe wiƒôkszo≈õƒá ofert mie≈õci siƒô w tym zakresie.

-   **Mniej mieszka≈Ñ w bardzo wysokich cenach** ‚Äì ceny powy≈ºej 10 000 sƒÖ rzadkie.

-   **Mo≈ºliwe warto≈õci odstajƒÖce** ‚Äì obecno≈õƒá mieszka≈Ñ z cenami powy≈ºej 15 000 sugeruje istnienie drogich, ale nietypowych ofert.

9.  ≈örednia cena w podziale na miasto i typ mieszkania

```{r echo=FALSE, message=FALSE, warning=FALSE}
grouped_data <- data %>%
  group_by(city, type) %>%
  summarise(avg_price = mean(price))

ggplot(grouped_data, aes(x = city, y = avg_price, fill = type)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("skyblue2", "lightskyblue1", "skyblue4")) +
  labs(
    title = "≈örednia cena w podziale na miasto i typ budynku",
    x = "Miasto",
    y = "≈örednia cena",
    fill = "Typ budynku"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

*Warszawa dominuje w trzech kategoriach typu budynku, pod wzglƒôdem ≈õredniej ceny wynajmu mieszkania.*

10. Rozk≈Çad cech dla mieszka≈Ñ

```{r echo=FALSE, message=FALSE, warning=FALSE}

long_data <- data %>%
  select(hasParkingSpace, hasElevator, hasSecurity, hasStorageRoom) %>%
  pivot_longer(cols = everything(), names_to = "Feature", values_to = "Value")

ggplot(long_data, aes(x = Feature, fill = Value)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(values = c("skyblue2", "skyblue4")) +
  labs(
    title = "Rozk≈Çad cech dla mieszka≈Ñ",
    x = "Cechy",
    y = "Liczba mieszka≈Ñ",
    fill = "Warto≈õƒá"
  ) +
  theme_minimal()


```

*Wiƒôkszo≈õƒá mieszka≈Ñ nie posiada ochrony i kom√≥rki lokatorskiej*

### Statystyki opisowe

1.  Mieszkania w Polsce - ceny wg liczby pokoi.

```{r echo=FALSE, message=FALSE, warning=FALSE}

raport <-
  list("Cena" =
       list("Min"= ~ min(price),
            "Max"= ~ max(price),
            "Kwartyl dolny"= ~ quantile(price,0.25),
            "Mediana"= ~ round(median(price),2),
            "Kwartyl g√≥rny"= ~ quantile(price,0.75),
            "≈örednia"= ~ round(mean(price),2),
            "Odch. std."= ~ round(sd(price),2),
            "IQR"= ~ round(IQR(price),2),
            "Odchylenie ƒáwiartkowe"= ~ round(IQR(price)/2,2),
            "Odch. std. w %"= ~ round((sd(price)/mean(price)),2),
            "Odch. ƒáwiartkowe w %" = ~ round((IQR(price)/median(price)),2),
            "Sko≈õno≈õƒá" = ~ round(skew(price),2),
            "Kurtoza" = ~ round(kurtosi(price),2)
            ))


tabela <- summary_table(data, summaries = raport, by = c("rooms"))
tabela <- tabela[-1,] 

tabela <- gsub("&nbsp;", "", tabela)
tabela <- gsub("~", "", tabela)

kable(tabela, caption = "Tabela 1. Mieszkania w Polsce - ceny wg liczby pokoi.",
      col.names = c("Statystyka", "1 pok√≥j", "2 pokoje", "3 pokoje", "4 pokoje", "5 pokoi", "6 pokoi")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) %>%
  row_spec(0, bold = TRUE, color = "white", background = "skyblue2") %>%
  row_spec(1:nrow(tabela), extra_css = "padding-bottom: 15px;")


```

-   **Zmienno≈õƒá cen**: *Ceny wynajmu sƒÖ bardzo zr√≥≈ºnicowane, od 415 z≈Ç za jednopokojowe mieszkanie do 19 500 z≈Ç za mieszkanie z 5 pokojami.*

-   **≈örednia cena**: *≈örednia cena wynajmu ro≈õnie wraz z liczbƒÖ pokoi, od 2 185,95 z≈Ç za jednopokojowe do 11 657 z≈Ç za sze≈õcio pokojowe mieszkanie.*

-   **Rozk≈Çady**: *Ceny mieszka≈Ñ wiƒôkszych sƒÖ bardziej zr√≥≈ºnicowane (wy≈ºsze odchylenie standardowe i IQR), a rozk≈Çady sƒÖ przewa≈ºnie prawostronnie sko≈õne.*

2.  Mieszkania w Polsce - ceny wg dekad

```{r}

data$dekada <- cut(data$buildYear, breaks=seq(1900, 2020, by=10), right=FALSE, labels=paste(seq(1900, 2010, by=10), seq(1909, 2019, by=10), sep="-"))


raport <-
  list("Cena" =
       list("Min"= ~ min(price),
            "Max"= ~ max(price),
            "Kwartyl dolny"= ~ quantile(price, 0.25),
            "Mediana"= ~ round(median(price), 2),
            "Kwartyl g√≥rny"= ~ quantile(price, 0.75),
            "≈örednia"= ~ round(mean(price), 1),
            "Odch. std."= ~ round(sd(price), 1),
            "IQR"= ~ round(IQR(price), 2),
            "Odchylenie ƒáwiartkowe"= ~ round(IQR(price) / 2, 2),
            "Odch. std. w %"= ~ round((sd(price) / mean(price)), 2),
            "Odch. ƒáwiartkowe w %"= ~ round((IQR(price) / median(price)), 2),
            "Sko≈õno≈õƒá"= ~ round(skew(price), 2),
            "Kurtoza"= ~ round(kurtosi(price), 2)
            ))


tabela2 <- summary_table(data, summaries = raport, by = c("dekada"))
tabela2 <- tabela2[-1,] 

tabela2 <- gsub("&nbsp;", "", tabela2)
tabela2 <- gsub("~", "", tabela2)
kable(tabela2, caption="Tabela 2. Mieszkania w Polsce - ceny wg dekad.",
             col.names = c("Statystyka", "1900-1909", "1910-1919", "1920-1929", 
                           "1930-1939", "1940-1949", "1950-1959", "1960-1969",
                           "1970-1979", "1980-1989", "1990-1999", "2000-2009",
                           "2010-2019")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) %>%
  row_spec(0, bold = TRUE, color = "white", background = "skyblue2") %>%  
  row_spec(1:nrow(tabela2), extra_css = "padding-bottom: 15px;")  


```

-   **Zmienno≈õƒá cen**: *Ceny wynajmu mieszka≈Ñ z r√≥≈ºnych dekad wahajƒÖ siƒô od 415 z≈Ç do 19 500 z≈Ç.*

-   **≈örednia cena**: *≈örednie ceny wynajmu rosnƒÖ na przestrzeni dekad, np. od 3 953,5 z≈Ç (1900-1909) do 4 724,8 z≈Ç (1910-1919).*

-   **Rozk≈Çady**: *Ceny sƒÖ bardziej zr√≥≈ºnicowane w starszych dekadach (wy≈ºsze odchylenie standardowe i IQR). Rozk≈Çady cen sƒÖ przewa≈ºnie prawostronnie sko≈õne (wiƒôksze warto≈õci Sko≈õno≈õci).*

3.  Mieszkania w Polsce - cena w poszczeg√≥lnym metra≈ºu.

```{r echo=FALSE, message=FALSE, warning=FALSE}

data$powierzchnia_przedzial <- cut(data$squareMeters, breaks=seq(20, max(data$squareMeters, na.rm=TRUE), by=20), right=FALSE)

raport <-
  list("Cena" =
       list("Min"= ~ min(price),
            "Max"= ~ max(price),
            "Kwartyl dolny"= ~ quantile(price, 0.25),
            "Mediana"= ~ round(median(price), 2),
            "Kwartyl g√≥rny"= ~ quantile(price, 0.75),
            "≈örednia"= ~ round(mean(price), 1),
            "Odch. std."= ~ round(sd(price), 1),
            "IQR"= ~ round(IQR(price), 2),
            "Odchylenie ƒáwiartkowe"= ~ round(IQR(price) / 2, 2),
            "Odch. std. w %"= ~ round((sd(price) / mean(price)), 2),
            "Odch. ƒáwiartkowe w %"= ~ round((IQR(price) / median(price)), 2),
            "Sko≈õno≈õƒá"= ~ round(skew(price), 2),
            "Kurtoza"= ~ round(kurtosi(price), 2)
            ))


tabela_m2 <- summary_table(data, summaries = raport, by = c("powierzchnia_przedzial"))

tabela_m2 <- tabela_m2[-1,] 

tabela_m2 <- gsub("&nbsp;", "", tabela_m2)
tabela_m2 <- gsub("~", "", tabela_m2)


kable(tabela_m2, caption = "Tabela 3. Mieszkania w Polsce - cena w poszczeg√≥lnym metra≈ºu.",
      col.names = c("Statystyka", "20-40", "40-60", "60-80", 
                           "80-100", "100-120", "120-140")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) %>%
  row_spec(0, bold = TRUE, color = "white", background = "skyblue2") %>%
  row_spec(1:nrow(tabela), extra_css = "padding-bottom: 15px;")
```

-   **Zmienno≈õƒá cen**: *Ceny wynajmu wzrastajƒÖ wraz ze zwiƒôkszaniem siƒô powierzchni mieszka≈Ñ, od 415 z≈Ç (20-40 m¬≤) do 19 000 z≈Ç (120-140 m¬≤).*

-   **≈örednia cena**: *≈örednie ceny wynajmu rosnƒÖ wraz z powierzchniƒÖ mieszka≈Ñ, od 2 402,2 z≈Ç (20-40 m¬≤) do 10 149 z≈Ç (120-140 m¬≤).*

-   **Rozk≈Çady**: *Ceny wynajmu wiƒôkszych mieszka≈Ñ sƒÖ bardziej zr√≥≈ºnicowane (wy≈ºsze odchylenie standardowe i IQR), a rozk≈Çady cen majƒÖ tendencjƒô do prawostronnej sko≈õno≈õci.*

### Macierz Koleracji

```{r echo=FALSE, message=FALSE, warning=FALSE}
numeryczne_kolumny <- select_if(data, is.numeric) 
corrplot(cor(numeryczne_kolumny), method = "number", diag =FALSE)
```

-   **Silne korelacje**:

*Metry kwadratowe wykazujƒÖ silnƒÖ pozytywnƒÖ korelacjƒô z cenƒÖ, co oznacza, ≈ºe wiƒôksza powierzchnia mieszkania zazwyczaj wiƒÖ≈ºe siƒô z wy≈ºszƒÖ cenƒÖ.*

*Liczba pokoi r√≥wnie≈º ma znaczƒÖcy wp≈Çyw na cenƒô, z dodatniƒÖ korelacjƒÖ.*

-   **S≈Çabe korelacje**:

*Korelacje miƒôdzy cenƒÖ a piƒôtrem, na kt√≥rym znajduje siƒô mieszkanie, sƒÖ s≈Çabe, co sugeruje, ≈ºe piƒôtro ma mniejszy wp≈Çyw na cenƒô.*

*Odleg≈Ço≈õƒá do punkt√≥w zainteresowania, takich jak szko≈Çy czy sklepy, ma niewielki wp≈Çyw na cenƒô.*

### *Testy statystyczne*

1.  Test normalno≈õci rozk≈Çadu cen Andersona-Darlinga

```{r echo=FALSE, message=FALSE, warning=FALSE}
Darling <- ad.test(data$price)
print(Darling)
```

*Przy tak niskiej warto≈õci p, mo≈ºemy odrzuciƒá hipotezƒô zerowƒÖ o normalno≈õci rozk≈Çadu danych (cen).*

2.  Test t-Studenta dla cen mieszka≈Ñ z parkingiem i bez \# Tworzymy zmiennƒÖ parking_binarny \# 1 - mieszkania z parkingiem, 0 - bez parkingu

```{r echo=FALSE, message=FALSE, warning=FALSE}
data$parking_binarny <- ifelse(data$hasParkingSpace == "yes", 1, 0)
t_test <- t.test(price ~ parking_binarny, data = data)
print(t_test)
```

-   **Statystyka testu (t)**: Wynosi -7,1377, co sugeruje istotnƒÖ r√≥≈ºnicƒô miƒôdzy ≈õrednimi cen w dw√≥ch grupach (z i bez parkingu).

-   **Warto≈õƒá p (p-value)**: Jest bardzo niska (1,039e-12), co oznacza, ≈ºe r√≥≈ºnica miƒôdzy grupami jest statystycznie istotna.

-   **Przedzia≈Ç ufno≈õci 95%**: Oznacza, ≈ºe rzeczywista r√≥≈ºnica ≈õrednich cen pomiƒôdzy grupami mie≈õci siƒô w przedziale od -461,1609 do -262,4331 z≈Ç.

-   **≈örednie ceny**: ≈örednia cena wynajmu bez parkingu to 3 555,366 z≈Ç, a z parkingiem to 3 917,163 z≈Ç.

3.  Test chi-kwadrat dla zmiennych kategorialnych i Zale≈ºno≈õƒá miƒôdzy posiadaniem parkingu a liczbƒÖ pokoi

```{r echo=FALSE, message=FALSE, warning=FALSE}
tablica_kontyngencji <- table(data$parking_binarny, data$rooms)
chi2_test <- chisq.test(tablica_kontyngencji)
print(chi2_test)
```

*Istnieje istotna zale≈ºno≈õƒá miƒôdzy posiadaniem parkingu a liczbƒÖ pokoi w mieszkaniach. To oznacza, ≈ºe posiadanie parkingu jest zwiƒÖzane z liczbƒÖ pokoi w spos√≥b statystycznie istotny.*

### **Modelowanie**

1.  Regresja liniowa: jak powierzchnia wp≈Çywa na cenƒô?

```{r echo=FALSE, message=FALSE, warning=FALSE}
linear_model <- lm(price ~ squareMeters, data = data)
summary(linear_model)
```

*Powierzchnia mieszkania (squareMeters) jest istotnym predyktorem ceny (price), a model regresji liniowej dobrze wyja≈õnia zmienno≈õƒá cen.*

2.  Wizualizacja modelu liniowego

```{r echo=FALSE, message=FALSE, warning=FALSE}
plot(data$squareMeters, data$price, main = "Model liniowy: cena vs. powierzchnia", xlab = "Powierzchnia", ylab = "Cena", pch = 19, col = "darkgreen") +
abline(linear_model, col = "red", lwd = 2)
```

### **Wnioski Ko≈Ñcowe**

1.  **Mieszkania premium**: SƒÖ znacznie dro≈ºsze i majƒÖ bardziej zr√≥≈ºnicowany rozk≈Çad cen, co odzwierciedla r√≥≈ºnorodno≈õƒá w tej kategorii.

2.  **Niski standard**: Mieszkania o ni≈ºszym standardzie majƒÖ ni≈ºsze ceny, g≈Ç√≥wnie skupione w ni≈ºszym przedziale cenowym.

3.  **Podzia≈Ç cenowy**: Istnieje wyra≈∫ny podzia≈Ç miƒôdzy mieszkaniami premium a tymi o ni≈ºszym standardzie, co sugeruje segmentacjƒô rynku.

4.  **Cena a odleg≈Ço≈õƒá od centrum**: Ceny mieszka≈Ñ spadajƒÖ wraz z rosnƒÖcƒÖ odleg≈Ço≈õciƒÖ od centrum miasta. Bli≈ºej centrum (0-5 km) ceny sƒÖ bardzo zr√≥≈ºnicowane, podczas gdy dalej (powy≈ºej 10 km) ceny sƒÖ bardziej skupione w ni≈ºszych przedzia≈Çach.

5.  **Znaczenie lokalizacji**: Mieszkania bli≈ºej centrum majƒÖ wy≈ºsze ceny. Warszawa wyr√≥≈ºnia siƒô najwiƒôkszƒÖ liczbƒÖ mieszka≈Ñ na wynajem oraz najwy≈ºszymi ≈õrednimi cenami. W wiƒôkszych miastach, takich jak Krak√≥w, Wroc≈Çaw i Gda≈Ñsk, ceny r√≥wnie≈º sƒÖ wysokie, podczas gdy w mniejszych miastach (np. Radom, Czƒôstochowa) ceny sƒÖ znacznie ni≈ºsze.

6.  **Korelacje cen**: Cena ma negatywnƒÖ korelacjƒô z odleg≈Ço≈õciƒÖ od centrum oraz punkt√≥w zainteresowania (np. przedszkola, szko≈Çy). IstniejƒÖ tak≈ºe pozytywne korelacje miƒôdzy r√≥≈ºnymi odleg≈Ço≈õciami (np. odleg≈Ço≈õƒá od restauracji i apteki).

7.  **Rozk≈Çady cen**: Rozk≈Çady cen mieszka≈Ñ sƒÖ przewa≈ºnie prawostronnie sko≈õne, z wiƒôkszo≈õciƒÖ mieszka≈Ñ w przedziale 2000-4000 z≈Ç i rzadkimi, bardzo drogimi ofertami powy≈ºej 10 000 z≈Ç. Mo≈ºliwe sƒÖ warto≈õci odstajƒÖce powy≈ºej 15 000 z≈Ç.

8.  **Dodatkowe informacje**: Warszawa dominuje w trzech kategoriach typu budynku pod wzglƒôdem ≈õredniej ceny wynajmu. Wiƒôkszo≈õƒá mieszka≈Ñ nie posiada ochrony ani kom√≥rki lokatorskiej.
